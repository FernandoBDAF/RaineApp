# 3.1 Onboarding — Feature Specification

## Overview

The onboarding flow gates access to Raine through a branded splash screen, invite-only referral code entry, and social authentication. Users must enter a valid referral code before they can sign in. Authentication is provided exclusively via social providers (Instagram, Facebook, LinkedIn); email/password auth is not supported.

---

## Status

**Implemented — Mock Auth in Dev**

- Splash, Referral Code, Login, and Terms screens are implemented.
- Referral validation accepts any 7-character alphanumeric code (backend validation not yet connected).
- Social login uses mock authentication in development to avoid native SDK configuration.
- Production social auth requires Facebook and LinkedIn developer app configuration.

---

## Screens

### Splash

| Element | Specification |
|---------|---------------|
| Purpose | Brand reinforcement on every app launch |
| Display | Raine splash image centered on white background |
| Duration | 4 seconds |
| User interaction | None — no tappable elements, no skip |
| Navigation | Auto-advances after 4 seconds |
| Frequency | Shown on every app launch |
| Back gesture | Disabled (`gestureEnabled: false`) |

Implementation: `src/app/(onboarding)/splash.tsx`

### Referral Code Entry

| Element | Specification |
|---------|---------------|
| Purpose | Gate access to invite-only beta |
| Headline | "Raine is invite only." |
| Subheadlines | "No strangers." / "Just friends of friends." |
| Code field | Text input, exactly 7 alphanumeric characters |
| Submit trigger | Auto-validates when 7th character is entered |
| Error feedback | Screen shake animation plus inline error message |
| Error message | "Invalid code. Please try again" |
| Error recovery | Field clears on error, input refocused |
| Success behavior | Store code locally via MMKV, then navigate to Login |
| Request invite | Link opens mailto with pre-populated template |

Request Invite email template:
- To: access@raineapp.com
- Subject: Request for Raine Invite
- Body: Name, Email, Location fields

Implementation: `src/app/(onboarding)/referral.tsx`

### Login

| Element | Specification |
|---------|---------------|
| Purpose | Authenticate users via social providers only |
| Headline | "Welcome to Raine" |
| Subheadline | "Sign in to continue" |
| Auth providers | Instagram, Facebook, LinkedIn (in order) |
| Button style | Full-width, provider brand colors |
| Terms | Link to Terms of Service and Privacy Policy |
| Reset | Optional "Reset app data" control for development |

Implementation: `src/app/(auth)/login.tsx`

### Terms

| Element | Specification |
|---------|---------------|
| Purpose | Display Terms of Service and Privacy Policy |
| Content | Placeholder legal content; to be replaced before launch |

Implementation: `src/app/(auth)/terms.tsx`

---

## User Flow

```
App Launch
    |
    v
Splash (4 seconds)
    |
    v
Has valid referral code stored?
    |
    +-- No  --> Referral Code Entry --> Valid code? --> Login
    |                    |                    |
    |                    +-- Invalid --> Shake + error, retry
    |
    +-- Yes --> Login
                    |
                    v
            Social sign-in (IG / FB / LinkedIn)
                    |
                    v
            Profile Setup (see 3.2)
                    |
                    v
            Main App (Tabs)
```

---

## Validation Rules

### Referral Code

| Rule | Specification |
|------|---------------|
| Format | Exactly 7 alphanumeric characters |
| Pattern | `^[A-Za-z0-9]{7}$` |
| Case | Input normalized to uppercase for display |
| Backend | Validation stubbed; accepts any valid format. Future: check against backend, single-use consumption. |

---

## Social Login Providers

| Provider | Background | Label | Notes |
|----------|-------------|-------|-------|
| Instagram | `#E1306C` | Continue with Instagram | Uses Facebook Login SDK (shared OAuth) |
| Facebook | `#1877F2` | Continue with Facebook | Native Firebase/Facebook SDK |
| LinkedIn | `#0A66C2` | Continue with LinkedIn | Not yet implemented in production; uses mock in dev |

Provider order on Login screen: Instagram, Facebook, LinkedIn.

---

## Mock Mode Behavior

In development (`isDev` or `isFirebaseMockMode()`):

- **Facebook / Instagram:** Calls `mockSocialLogin()` instead of real SDK. Logs `[Mock] {provider} sign in`. Avoids crashes from unconfigured Facebook App ID.
- **LinkedIn:** Same mock flow as other providers. In production, currently returns "LinkedIn sign in not yet implemented."
- **Sign out:** Uses `setMockUser(null)` instead of Firebase auth sign-out.
- **Real SDK:** Enabled only when not in dev and not in Firebase mock mode.

---

## Storage

| Key | Purpose |
|-----|---------|
| `onboarding.referralCode` | Validated referral code (JSON: `code`, `validatedAt`) |
| `onboarding.referralValidatedAt` | ISO timestamp of validation |

---

## Cross-References

| Document | Relationship |
|----------|--------------|
| **3.2 Profile Setup** | After successful social login, users are directed to Profile Setup before entering the main app. |
| **2-USER-FLOWS** | Onboarding is the first stage of the authenticated user journey. |
| **1-PRODUCT-OVERVIEW** | Onboarding enforces invite-only access and social-only authentication. |

---

## Technical References

| Component | Path |
|-----------|------|
| Splash screen | `src/app/(onboarding)/splash.tsx` |
| Referral screen | `src/app/(onboarding)/referral.tsx` |
| Login screen | `src/app/(auth)/login.tsx` |
| Terms screen | `src/app/(auth)/terms.tsx` |
| Referral service | `src/services/referral/index.ts` |
| Social auth | `src/services/firebase/socialAuth.ts` |
| Onboarding implementation plan | `implementation-history/2-onboarding-implementation-plan.md` |
